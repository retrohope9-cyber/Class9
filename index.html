<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mount Assisi Class 9 Notes</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00d2ff; --neon-purple: #9d50bb; --bg: #05070a; --glass: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #05070a 100%); color: #fff; margin: 0; min-height: 100vh; overflow-x: hidden; }
        
        .page { display: none; width: 100%; min-height: 100vh; padding: 40px 20px; box-sizing: border-box; animation: slideIn 0.4s ease-out; }
        .active { display: flex; flex-direction: column; align-items: center; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }

        h1 { font-family: 'Orbitron', sans-serif; text-align: center; background: linear-gradient(to right, var(--neon-blue), var(--neon-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
        
        /* Navigation */
        .card-container { display: flex; gap: 20px; margin-top: 50px; }
        .menu-card { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 40px 60px; border-radius: 20px; cursor: pointer; backdrop-filter: blur(10px); transition: 0.3s; text-align: center; }
        .menu-card:hover { border-color: var(--neon-blue); transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 210, 255, 0.2); }

        /* Grid Layouts */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; width: 100%; max-width: 800px; }
        .item-btn { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.2s; font-weight: 600; text-transform: uppercase; }
        .item-btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }

        .back-btn { align-self: flex-start; margin-bottom: 20px; color: var(--neon-blue); cursor: pointer; font-weight: bold; text-decoration: none; border: 1px solid var(--neon-blue); padding: 5px 15px; border-radius: 5px; }

        /* Form Styling */
        .glass-box { background: var(--glass); padding: 30px; border-radius: 25px; width: 100%; max-width: 500px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        input, select, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: #000; color: #fff; font-family: inherit; }
        .submit-btn { background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple)); border: none; cursor: pointer; font-weight: bold; font-family: 'Orbitron', sans-serif; text-transform: uppercase; margin-top: 20px; }

        /* Notes Display */
        .note-card { background: var(--glass); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); width: 100%; margin-bottom: 20px; box-sizing: border-box; }
        .poster-info { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .poster-name { font-weight: bold; color: var(--neon-blue); font-size: 1.1rem; }
        .note-card img { width: 100%; border-radius: 15px; border: 2px solid var(--neon-purple); cursor: zoom-in; }
    </style>
</head>
<body>

    <div id="homePage" class="page active">
        <h1>MOUNT ASSISI CLASS 9 NOTES</h1>
        <p style="color: #888; font-size: 1.1rem;">BY RETRO HOPE</p>
        <div class="card-container">
            <div class="menu-card" onclick="openPost()"><h2>POST</h2></div>
            <div class="menu-card" onclick="navigateTo('subjectPage')"><h2>SEE</h2></div>
        </div>
    </div>

    <div id="postPage" class="page">
        <div class="back-btn" onclick="navigateTo('homePage')">← BACK HOME</div>
        <div class="glass-box">
            <h1 style="font-size: 1.5rem;">Upload Note</h1>
            <input type="text" id="userName" placeholder="Your Unique Name">
            <select id="postSubject">
                <option value="">Select Subject</option>
                <option>SST</option><option>G.K</option><option>Computer</option>
                <option>H.LANG</option><option>Science</option><option>Eng Lit</option>
                <option>Eng gra</option><option>Eng Lang</option><option>H.Lit</option><option>MATHS</option>
            </select>
            <input type="text" id="postChapter" placeholder="Enter Chapter Name (e.g. Ch-1)">
            <select id="postSource">
                <option value="Copy">Handwritten (Copy)</option>
                <option value="Book">Printed (Book)</option>
            </select>
            <input type="file" id="imageInput" accept="image/*">
            <button class="submit-btn" id="uploadBtn">PUBLISH TO HUB</button>
        </div>
    </div>

    <div id="subjectPage" class="page">
        <div class="back-btn" onclick="navigateTo('homePage')">← BACK</div>
        <h1>Select Subject</h1>
        <div class="grid" id="subjectGrid"></div>
    </div>

    <div id="chapterPage" class="page">
        <div class="back-btn" onclick="navigateTo('subjectPage')">← BACK</div>
        <h1 id="selectedSubTitle">Chapters</h1>
        <div class="grid" id="chapterList"></div>
    </div>

    <div id="sourcePage" class="page">
        <div class="back-btn" onclick="navigateTo('chapterPage')">← BACK</div>
        <h1>Select Type</h1>
        <div class="grid">
            <div class="item-btn" onclick="viewFinalNotes('Book')">FROM BOOK</div>
            <div class="item-btn" onclick="viewFinalNotes('Copy')">FROM COPY</div>
        </div>
    </div>

    <div id="notesPage" class="page">
        <div class="back-btn" onclick="navigateTo('sourcePage')">← BACK</div>
        <h1 id="finalTitle">Notes Gallery</h1>
        <div id="notesDisplayArea" style="width: 100%; max-width: 800px;"></div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCo56hgaC3u_tBtS_bN0z2mrY9NQx0xZDg",
        authDomain: "class9notes-5b2f9.firebaseapp.com",
        projectId: "class9notes-5b2f9",
        storageBucket: "class9notes-5b2f9.firebasestorage.app",
        messagingSenderId: "818425070351",
        appId: "1:818425070351:web:815e3881e8672a4a48f47a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const IMGBB_API = "965fa1c8fd25314c86fc7e40d845a83a";

    let currentSubject = "";
    let currentChapter = "";

    window.navigateTo = (pageId) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        window.scrollTo(0,0);
    };

    // PASSWORD GATE
    window.openPost = () => {
        const access = prompt("Enter Secret Password to Post:");
        if (access === "@777") {
            navigateTo('postPage');
        } else {
            alert("Access Denied: Incorrect Password.");
        }
    };

    // 1. Initialize Subjects
    const subs = ["SST", "G.K", "Computer", "H.LANG", "Science", "Eng Lit", "Eng gra", "Eng Lang", "H.Lit", "MATHS"];
    const sGrid = document.getElementById('subjectGrid');
    subs.forEach(s => {
        const btn = document.createElement('div');
        btn.className = 'item-btn';
        btn.innerText = s;
        btn.onclick = () => loadDynamicChapters(s);
        sGrid.appendChild(btn);
    });

    // 2. Load Chapters based on existing posts
    async function loadDynamicChapters(sub) {
        currentSubject = sub;
        document.getElementById('selectedSubTitle').innerText = sub + " Chapters";
        navigateTo('chapterPage');
        
        const list = document.getElementById('chapterList');
        list.innerHTML = "<p>Scanning for posts...</p>";

        const q = query(collection(db, "all_notes"), where("subject", "==", sub));
        const snap = await getDocs(q);
        
        const chapters = new Set();
        snap.forEach(doc => chapters.add(doc.data().chapter));

        list.innerHTML = "";
        if(chapters.size === 0) {
            list.innerHTML = "<p>No chapters have been posted for this subject yet.</p>";
            return;
        }

        chapters.forEach(ch => {
            const btn = document.createElement('div');
            btn.className = 'item-btn';
            btn.innerText = ch;
            btn.onclick = () => { currentChapter = ch; navigateTo('sourcePage'); };
            list.appendChild(btn);
        });
    }

    // 3. POSTING LOGIC
    document.getElementById('uploadBtn').onclick = async () => {
        const name = document.getElementById('userName').value.trim();
        const sub = document.getElementById('postSubject').value;
        const chap = document.getElementById('postChapter').value.trim();
        const src = document.getElementById('postSource').value;
        const file = document.getElementById('imageInput').files[0];

        if(!name || !chap || !file || !sub) return alert("Fill all info!");

        const btn = document.getElementById('uploadBtn');
        btn.innerText = "Processing...";
        btn.disabled = true;

        // Image Upload
        const formData = new FormData();
        formData.append("image", file);
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API}`, {method: "POST", body: formData});
        const img = await res.json();

        // Save to Firebase
        await addDoc(collection(db, "all_notes"), {
            author: name,
            author_lower: name.toLowerCase(),
            subject: sub,
            chapter: chap,
            source: src,
            url: img.data.url,
            timestamp: new Date().getTime()
        });

        alert("Notes Published Successfully!");
        location.reload();
    };

    // 4. VIEW LOGIC
    window.viewFinalNotes = async (sourceType) => {
        navigateTo('notesPage');
        const area = document.getElementById('notesDisplayArea');
        area.innerHTML = "<p>Fetching handwriting...</p>";
        
        const q = query(collection(db, "all_notes"), 
            where("subject", "==", currentSubject),
            where("chapter", "==", currentChapter),
            where("source", "==", sourceType)
        );
        
        const snap = await getDocs(q);
        area.innerHTML = `<h2 style='text-align:center; color:var(--neon-blue)'>${currentSubject} - ${currentChapter}</h2>`;
        
        if(snap.empty) {
            area.innerHTML += "<p style='text-align:center'>No notes found in this category.</p>";
            return;
        }

        snap.forEach(doc => {
            const d = doc.data();
            area.innerHTML += `
                <div class="note-card">
                    <div class="poster-info">
                        <span style="color:#888; font-size:0.8rem;">AUTHOR:</span>
                        <span class="poster-name">${d.author}</span>
                    </div>
                    <img src="${d.url}" onclick="window.open('${d.url}', '_blank')">
                </div>
            `;
        });
    };
</script>
</body>
  </html>
      
